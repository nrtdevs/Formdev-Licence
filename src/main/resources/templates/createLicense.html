<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Create License</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, rgb(128, 128, 195), #2c3e50);
            color: #fff;
        }

        header {
            background-color: rgb(128, 128, 255);
            color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        nav ul li {
            display: inline;
            margin-right: 20px;
        }

        nav ul li a {
            text-decoration: none;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
            transition: color 0.3s ease-in-out;
        }

        nav ul li a:hover {
            color: #ffcc00;
        }

        .dropdown ul li a:hover {
            color: rgb(255, 255, 255);
            background-color: rgb(128, 128, 255);
        }

        main {
            padding: 20px;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            color: #333;
        }

        h1 {
            color: rgb(128, 128, 255);
            text-align: center;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .form-section h3 {
            color: rgb(128, 128, 255);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        .btn-submit {
            background-color: rgb(128, 128, 255);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: block;
            margin: 30px auto 0;
            width: 200px;
        }

        .btn-submit:hover {
            background-color: rgb(100, 100, 220);
        }

        .conditional-field {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid rgb(128, 128, 255);
        }

        select[multiple] {
            height: auto;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">License Module</div>
        <nav>
            <ul>
                <li><a href="http://localhost:8181/admin/homePage">Home</a></li>
          
       
            
                <li><a href="http://localhost:8181/logout">Logout</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="form-container">
            <h1>Create New License</h1>
            <form id="licenseForm">
                
                <!-- Section 1: Company Details -->
                <div class="form-section">
                    <h3>1. Company Details</h3>
                    <div class="form-group">
                        <label for="companyName" class="form-label">Company Name</label>
                        <input type="text" id="companyName" name="companyName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactPerson" class="form-label">Contact Person's Name</label>
                        <input type="text" id="contactPerson" name="name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" id="phone" name="phoneNumber" class="form-control" required>
                    </div>
                </div>
                
                <!-- Section 2: Contact Information -->
                <div class="form-section">
                    <h3>2. Contact Information</h3>
                    <div class="form-group">
                        <label for="primaryContactName" class="form-label">Primary Contact Name</label>
                        <input type="text" id="primaryContactName" name="primaryContactName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="primaryContactNumber" class="form-label">Primary Contact Number</label>
                        <input type="tel" id="primaryContactNumber" name="primaryContactNumber" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="scmContactName" class="form-label">SCM Contact Name</label>
                        <input type="text" id="scmContactName" name="scmContactName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="scmContactNumber" class="form-label">SCM Contact Number</label>
                        <input type="tel" id="scmContactNumber" name="scmContactNumber" class="form-control" required>
                    </div>
                </div>
                
                <!-- Section 3: License Selection -->
                <div class="form-section">
                    <h3>3. License Selection</h3>
                    <div class="form-group">
                        <label for="licenseFor" class="form-label">License For</label>
                        <select id="licenseFor" name="licenseFor" class="form-control" required>
                            <option value="">Select Product</option>
                            <option value="FORMSCI">FORMSCI</option>
                            <option value="SOLUDEM">SOLUDEM</option>
                            <option value="ELABNOTE">ELABNOTE</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="licenseType" class="form-label">License Type</label>
                        <select id="licenseType" name="licenseType" class="form-control" required>
                            <option value="">Select Type</option>
                            <option value="MAC_ID">Mac Based</option>
                            <option value="EMAIL_ID">Email Based</option>
                        </select>
                    </div>
                    
                    <!-- Mac Based Fields -->
                    <div id="macBasedFields" class="conditional-field">
                        <div class="form-group">
                            <label for="macId" class="form-label">MAC ID (e.g., 00:1A:2B:3C:4D:5E)</label>
                            <input type="text" id="macId" name="macId" class="form-control" placeholder="00:1A:2B:3C:4D:5E">
                        </div>
                        
                        <div class="form-group">
                            <label for="modules" class="form-label">Select Modules</label>
                            <select id="modules" name="modules" class="form-control" multiple>
                                <!-- Options will be populated based on licenseFor selection -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="macTenureDays" class="form-label">Tenure (in days)</label>
                            <input type="number" id="macTenureDays" name="macTenureDays" class="form-control" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="usageCount" class="form-label">Number of Usages</label>
                            <input type="number" id="usageCount" name="usageCount" class="form-control" min="1">
                        </div>
                    </div>
                    
                    <!-- Email Based Fields -->
                    <div id="emailBasedFields" class="conditional-field">
                        <div class="form-group">
                            <label for="userEmail" class="form-label">Email</label>
                            <input type="email" id="userEmail" name="userEmail" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailTenureDays" class="form-label">Tenure (in days)</label>
                            <input type="number" id="emailTenureDays" name="duration" class="form-control" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailModules" class="form-label">Select Modules</label>
                            <select id="emailModules" name="modules" class="form-control" multiple>
                                <!-- Options will be populated based on licenseFor selection -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="weeklyLimit" class="form-label">Weekly Usage Limit</label>
                            <input type="number" id="weeklyLimit" name="weeklyLimit" class="form-control" min="1">
                        </div>
                    </div>
                </div>
                
                <!-- License Purpose -->
                <div class="form-section">
                    <label for="licensePurpose" class="form-label">License Purpose</label>
                    <select id="licensePurpose" name="type" class="form-control" required>
                        <option value="purchase">Purchase</option>
                        <option value="demo">Demo</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-submit">Create License</button>
            </form>
        </div>
    </main>

 <script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('licenseForm');
        const licenseType = document.getElementById('licenseType');
        const macBasedFields = document.getElementById('macBasedFields');
        const emailBasedFields = document.getElementById('emailBasedFields');
        const licenseFor = document.getElementById('licenseFor');
        const modulesSelect = document.getElementById('modules');
        const emailModulesSelect = document.getElementById('emailModules');

        initForm();

        licenseType.addEventListener('change', toggleLicenseTypeFields);
        licenseFor.addEventListener('change', populateModules);
        form.addEventListener('submit', handleFormSubmit);

        function initForm() {
            toggleLicenseTypeFields();
            populateModules();
        }

        function toggleLicenseTypeFields() {
            const selectedType = licenseType.value;
            macBasedFields.style.display = 'none';
            emailBasedFields.style.display = 'none';

            if (selectedType === 'MAC_ID') {
                macBasedFields.style.display = 'block';
            } else if (selectedType === 'EMAIL_ID') {
                emailBasedFields.style.display = 'block';
            }
        }

        function populateModules() {
            const selectedProduct = licenseFor.value;
            modulesSelect.innerHTML = '';
            emailModulesSelect.innerHTML = '';

            const moduleList = {
              FORMSCI: [
    'DEM file creation',
    'Drug - Excipient comparability',
    'Single Stability estimation',
    'Multi formula stability',
    'Impurity control',
    'ASD screening',
    'Permeation enhancers screening',
    'Package screening',
    'Dissolution screening',
    'Formulation Solvent selection'
],

SOLUDEM: [
    'Pure solvents screening',
    'Binary solvents screening',
    'Ternary solvents screening',
    'ASD screening',
    'pH solubility screening',
    'Salt screening',
    'XRD analysis',
    'Formulation Solubility screening',
    'NCE BCS classification',
    'NCE stability',
    'Reaction Solvent screening',
    'Reaction base screening',
    'Impurity control analysis',
    'Bio & Dissolution media solubility',
    'Polymorph screening'
]

            };

            const selectedModules = moduleList[selectedProduct] || [];

            selectedModules.forEach(moduleName => {
                const option1 = new Option(moduleName, moduleName);
                const option2 = new Option(moduleName, moduleName);
                modulesSelect.add(option1);
                emailModulesSelect.add(option2);
            });
        }

        async function handleFormSubmit(e) {
            e.preventDefault();

            if (licenseType.value === 'MAC_ID') {
                const macId = document.getElementById('macId').value;
                const macRegex = /^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/;
                if (!macRegex.test(macId)) {
                    alert('Please enter a valid MAC ID (e.g. 00:1A:2B:3C:4D:5E)');
                    return;
                }
            }

            if (licenseType.value === 'EMAIL_ID') {
                const userEmail = document.getElementById('userEmail').value;
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(userEmail)) {
                    alert('Please enter a valid email address');
                    return;
                }
            }

            const formData = {
                companyName: document.getElementById('companyName').value,
                name: document.getElementById('contactPerson').value,
                email: document.getElementById('email').value,
                phoneNumber: document.getElementById('phone').value,
                primaryContactName: document.getElementById('primaryContactName').value,
                primaryContactNumber: document.getElementById('primaryContactNumber').value,
                scmContactName: document.getElementById('scmContactName').value,
                scmContactNumber: document.getElementById('scmContactNumber').value,
                licenseFor: licenseFor.value,
                licenseType: licenseType.value,
                type: document.getElementById('licensePurpose').value,
                macId: licenseType.value === 'MAC_ID' ? document.getElementById('macId').value : null,
                duration: licenseType.value === 'EMAIL_ID'
                    ? document.getElementById('emailTenureDays').value
                    : licenseType.value === 'MAC_ID'
                        ? document.getElementById('macTenureDays').value
                        : null,
                macUsageCount: licenseType.value === 'MAC_ID' ? document.getElementById('usageCount').value : null,
                weeklyLimit: licenseType.value === 'EMAIL_ID' ? document.getElementById('weeklyLimit').value : null,
                modules: licenseType.value === 'MAC_ID'
                    ? Array.from(modulesSelect.selectedOptions).map(o => o.value)
                    : licenseType.value === 'EMAIL_ID'
                        ? Array.from(emailModulesSelect.selectedOptions).map(o => o.value)
                        : [],
                userEmail: licenseType.value === 'EMAIL_ID' ? document.getElementById('userEmail').value : null
            };

           try {
         

   

          const response = await fetch('http://localhost:8181/licenses/createLicense', {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify(formData)
          });

          const data = await response.json();
          console.log('Response:', data);
          
          if (data) {
            alert('License Bought Successfully! \nFile Saved at: \n' + data.filePath);
            window.location.href = 'http://localhost:8181/users/home';
          } else {
            throw new Error('Error creating license');
          }
        } catch (error) {
          console.error('Submission error:', error);
          alert('Error: ' + error.message);
        }
        }
    });
</script>

</body>
</html>